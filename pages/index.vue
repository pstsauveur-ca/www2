<template>
  <div>
		<section class="wrapper bg-dark">
			<div class="swiper-container swiper-thumbs-container swiper-fullscreen nav-dark" data-margin="0" data-autoplay="false" data-autoplaytime="7000" data-nav="false" data-dots="false" data-items="1" data-thumbs="false">
			  <div class="swiper">
				<div class="swiper-wrapper">
				  <div class="swiper-slide bg-overlay bg-overlay-400 bg-light bg-image" data-image-src="/img/photos/toit-eglise.jpg"></div>
				</div>
				<!--/.swiper-wrapper -->
			  </div>
			  <!-- /.swiper -->
			  <div class="swiper-static">
				<div class="container h-100 d-flex align-items-center justify-content-center">
				  <div class="row">
					<div class="col-lg-8 mx-auto mt-n10 text-center">
					  <h1 class="fs-19 text-uppercase ls-xl text-white mb-3 animate__animated animate__zoomIn animate__delay-1s">
              <!-- La vie en abondance -->
            </h1>
					  <h2 class="display-1 fs-60 text-white mb-0 animate__animated animate__zoomIn animate__delay-2s"> 
              <!-- les merveilles que Dieu fait dans ma vie. -->
              La vie en abondance
            </h2>
					</div>
					<!-- /column -->
				  </div>
				  <!-- /.row -->
				</div>
				<!-- /.container -->
			  </div>
			  <!-- /.swiper-static -->
			</div>
			<!-- /.swiper-container -->
    </section>
    <!-- /section -->

    <section class="wrapper bg-light">
      <div class="container py-14 py-md-16">
        <div class="row gx-lg-8 gx-xl-12">
          <div class="col-lg-8 order-lg-2">
            <div class="blog classic-view">

              <!-- <BlogPost v-for="publication in publications"
                :image="`https://static.pstsauveur.ca/${publication.image}`"
                :title="publication.titre"
                :date="publication.formattedDate"
              >
                <div v-html="publication.texte" /> 
              </BlogPost> -->

              <BlogPost
                image="/img/photos/ski-hill-church.png"
                title="Célébrations pour le temps de Noël 2024"
                date="10 novembre 2024">
                <h3 class="display-6">Noël</h3>

                <p>
                    La vente de billets débutera le <strong>24 novembre</strong> pour les personnes ayant fait un don durant l’année à la paroisse. 
                    La vente se tiendra au sous-sol du presbytère, de <strong>9h à midi</strong>.
                </p>
                <p>
                    Pour toutes les autres personnes, la vente commencera le <strong>25 novembre</strong>.
                </p>

                <h4>Horaires des messes de Noël</h4>
                <ul>
                    <li><strong>Mardi 24 décembre</strong> : 17h00, 20h00, 22h00, minuit</li>
                    <li><strong>Mercredi 25 décembre</strong> : 11h00</li>
                </ul>

                <h3 class="display-6">Jour de l'an</h3>

                <h4>Horaires des célébrations du Nouvel An</h4>
                <ul>
                    <li><strong>Mardi 31 décembre</strong> (Veillée du jour de l’an) : Messe à 19h00, suivie d’une heure d’adoration pour rendre grâce à Dieu de tous ses bienfaits durant l’année 2024.</li>
                    <li><strong>Mercredi 1er janvier</strong> – Sainte Marie Mère de Dieu : Messe à 11h00</li>
                </ul>

                <p><strong>Paroisse Saint-Sauveur</strong><br>
                205 rue Principale, St-Sauveur, J0R 1R0</p>


              </BlogPost>

              <BlogPost
                image="https://static.pstsauveur.ca/97622300-14d6-42c5-abb0-d567d89209ae"
                title="Concert de louange"
                date="7 juillet 2024">
                <p>Le collectif le Feu sacré sera de passage dans notre paroisse le dimanche 7 juillet. Il animera les messes de 9h30 et 11h00. Un diner hamburger vous sera offert gratuitement (don à votre discrétion). Par la suite, à 13h30, un magnifique concert de louange vous sera offert dans l'église, durant lequel on rendra grâce à Dieu de tous ses bienfaits. Un temps de prière commun sera proposé accompagné de l'exposition du Saint Sacrement. Vous vivrez un moment inoubliable. Amenez des amis.</p>
              </BlogPost>

              <BlogPost 
                image="/img/photos/mont-golgotha.png"
                title="Défi du Carême 2024"
                date="23 Février 2024">
                <p>Ce Carême, nous vous invitons à approfondir votre lien avec la parole de Dieu à travers notre "Défi du Carême : Lecture de la Parole".</p>
                <p>Abandonnez-vous à ce temps de lecture et à la prière, en vous joignant à notre communauté. C'est l'occasion parfaite de ralentir, de méditer et de se rapprocher de Dieu dans l'intimité de votre foyer ou où que vous soyez.</p>
                <p>Comment participer ?</p>
                <ul>
                  <li>En ligne : Connectez-vous à nos séances sur <a href="https://www.facebook.com/events/908112034314649/908112047647981">Facebook Live</a> tous les lundis et jeudis, de 15h à 15h15. Chaque session sera un moment de calme et de réflexion, comprenant une lecture choisie de la parole de Dieu suivie d'une courte prière.</li>
                  <li>À la maison : Suivez notre parcours de lecture d’un évangile à votre rythme. Bien que nous n'énumérions pas spécifiquement les passages à l'avance, nous vous encourageons à vous joindre à nous pour une expérience partagée.</li>
                </ul>
                <p>Dates : Du 15 février au 25 mars</p>
                <p>Horaire : Les lundis et jeudis de 15h à 15h15</p>
                <p>Rejoignez notre communauté pour ce temps de Carême, un moment pour se recentrer, se renouveler et renforcer notre foi ensemble. Ce défi est une invitation à explorer la richesse et le réconfort de la parole de Dieu.</p>
                <p>Ensemble, faisons de ce Carême une période d’une vivante communion. #DéfiCarême</p>

                <YoutubeEmbed playlist-id="PLiAKJDisTJz4BbUQ65ycginEPCxP_JqMn"/>
              </BlogPost>

              <BlogPost 
                image="/img/photos/the_holy_spirit_blessing_a_Canadian_village_winter.png"
                title="Prière pour le renouveau de notre communauté paroissiale"
                date="5 Décembre 2022">
                <p>Dieu notre Père,</p>
                <p>Toi qui es plein de tendresse pour tes enfants;
                  comble-nous de ta grâce, de ta joie et de ta paix.</p>
                <p>Comme disciples du Christ, que les membres de notre communauté chrétienne soient
                  conscients de leur vocation à la sainteté, en partageant leurs
                  dons et leurs charismes, en les mettant au service de leurs frères
                  et soeurs.</p>
                <p>Envoie ton Esprit Saint pour que, dans ce nouvel élan
                  d’évangélisation, nous devenions missionnaires de foi,
                  d’espérance et d’amour auprès de nos familles, de nos
                  communautés et dans nos milieux de travail.</p>
                <p>Mets en nous le désir de vivre comme Toi, à l’exemple de la bienheureuse Catherine
                  de Saint-Augustin, afin que, d’autres expérimentent ton immense amour et ta divine miséricorde. Bénis notre communauté paroissiale pour qu’avec l’aide de Notre Dame de toute joie, elle soit un milieu favorable à la vocation du mariage, du sacerdoce et de la vie religieuse.</p>
                <p>Amen</p>
              </BlogPost>
              
            </div>
            <!-- /.blog -->
            <nav class="d-flex" aria-label="pagination">
              <ul class="pagination">
                <li class="page-item disabled">
                  <a class="page-link" href="#" aria-label="Previous">
                    <span aria-hidden="true"><i class="uil uil-arrow-left"></i></span>
                  </a>
                </li>
                <li class="page-item active"><a class="page-link" href="#">1</a></li>
                <!-- <li class="page-item"><a class="page-link" href="#">2</a></li> -->
                <!-- <li class="page-item"><a class="page-link" href="#">3</a></li> -->
                <li class="page-item">
                  <a class="page-link" href="#" aria-label="Next">
                    <span aria-hidden="true"><i class="uil uil-arrow-right"></i></span>
                  </a>
                </li>
              </ul>
              <!-- /.pagination -->
            </nav>
            <!-- /nav -->
          </div>
          <!-- /column -->
          <aside class="col-lg-4 sidebar mt-8 mt-lg-6">
            <div class="widget">
              <h4 class="widget-title mb-3">À propos de la paroisse</h4>
              <p>Située au cœur du village de Saint-Sauveur, la paroisse est au service de la population de Saint-Sauveur et de Piedmont depuis 1854. Au-delà de la belle vieille église, la paroisse est une communauté chrétienne dynamique qui prend plaisir à vous accueillir.
              </p>
            </div>
            <!-- /.widget -->

            <div class="widget">
              <!-- <Calendar color="blue" locale="fr-ca" /> -->
            </div>

            <div class="widget">
              <h4 class="widget-title mb-3">Événements à venir</h4>
              <ul class="image-list">
                <li v-for="event in upcomingEvents" :key="event._path">
                  <figure class="rounded">
                    <a :href=event.link>
                      <img :src="`https://static.pstsauveur.ca/${event.image}`" alt=""/>
                    </a>
                  </figure>
                  <div class="post-content">
                    <h6 class="mb-2">
                      <a class="link-dark" :href=event.link>
                        {{ event.titre }}
                      </a>
                    </h6>
                    <ul class="post-meta">
                      <li class="post-date">
                        <i class="uil uil-calendar-alt"></i>
                        <span>{{ event.formattedDate }}</span>
                      </li>
                    </ul>
                  </div>
                </li>
              </ul>
              <!-- /.image-list -->
            </div>
            <!-- /.widget -->

            <div class="widget">
              <a href="/evenements">
                <i class="uil uil-calendar-alt"></i>
                Voir tous les événements
              </a>
            </div>
            <!-- /.widget -->

            <div class="widget">
              <a href="https://www.semainierparoissial.com/semainiers/195.pdf">
                <i class="uil uil-external-link-alt"></i>
                Semainier Paroissial
              </a>
            </div>
            <!-- /.widget -->

          </aside>
          <!-- /column .sidebar -->
        </div>
        <!-- /.row -->
      </div>
      <!-- /.container -->
    </section>
    <!-- /section -->

    <ImplicationCTABox />
  </div>
</template>

<style>
.vc-container .vc-title {
  background: none;
}

.vc-container .vc-title span {
  text-transform: capitalize;
}

.vc-container .vc-weeks {
  padding: 1rem;
}

.vc-container .vc-weekday {
  padding-left: .5rem;
  padding-right: .5rem;
}

</style>

<script lang="ts" setup>
import 'v-calendar/style.css';
import { Calendar } from 'v-calendar';
import type { Attribute } from 'v-calendar/dist/types/src/utils/attribute'; 

const today = Date.now();

const { body: publications } = await queryContent('/').where({ _file: 'publications.json' }).findOne();

const { body: events } = await queryContent('/').where({ _file: 'evenements.json' }).findOne();

const upcomingEvents = events.filter((event) => {
  return new Date(event.date).getTime() > today;
});

const weeklyEvents = [
  {
    start: new Date(2023, 6, 30, 11),
    name: 'Messe du Dimanche (11h00)',
    weekdays: 1,
  },
  {
    start: new Date(2023, 6, 30, 9, 30),
    name: 'Messe du Dimanche (9h30)',
    weekdays: 1,
  },
  {
    start: new Date(2023, 6, 31, 8, 30),
    name: 'Messe (8h30)',
    weekdays: 2,
  },
  {
    start: new Date(2023, 6, 31, 8, 30),
    name: 'Messe (8h30)',
    weekdays: 3,
  },
  {
    start: new Date(2023, 6, 31, 8, 30),
    name: 'Messe (8h30)',
    weekdays: 4,
  },
  {
    start: new Date(2023, 7, 3, 8, 30),
    name: 'Messe (8h30)',
    weekdays: 5,
  },
  {
    start: new Date(2023, 7, 4, 8, 30),
    name: 'Messe (8h30)',
    weekdays: 6,
  },
];

// Month numbers start at 0
const normalScheduleIntervals = [{
  from: new Date(2023, 0, 1), to: new Date(2023, 11, 23),
}, 
{
  from: new Date(2023, 11, 26), to: new Date(2024, 2, 26),
},
// Enlever les messes du 26, 28, et 29
{
  from: new Date(2024, 2, 30)
}
];

const additionalEvents = [
// Mais garder la messe du 27  
{
  key: 'Messe (8h30)',
  dot: {
    color: 'blue'
  },
  dates: new Date(2024, 2, 27),
  popover: {
    label: 'Messe (8h30)',
  },
}
];



const normalSchedule = normalScheduleIntervals.flatMap(interval => {
  return weeklyEvents.map(event => {
    const startDate = new Date(interval.from);
    const targetDate = new Date(event.start);

    const day = event.weekdays - 1;
    const hour = targetDate.getDay();
    const minutes = targetDate.getDay();

    var distance = (day + 7 - startDate.getDay()) % 7;

    startDate.setDate(startDate.getDate() + distance);
    startDate.setHours(hour);
    startDate.setMinutes(minutes);

    return {
      key: event.name,
      dot: {
        color: 'blue'
      },
      dates: {
        start: startDate,
        repeat: {
          every: [1, 'weeks'],
          weekdays: event.weekdays,
          until: interval.to
        },
      },
      popover: {
        label: event.name,
      },
    }
  });
});

// console.log(normalSchedule.map(s => s.dates.start));

const calendarAttributes: Attribute[] = [
  {
    key: 'today',
    highlight: true,
    dates: new Date(),
    popover: {
      label: "Aujourd'hui",
    },
  },
  ...normalSchedule,
  ...additionalEvents,
  ...upcomingEvents.map(event => {
    return {
      key: event.title,
      highlight: {
        color: 'purple',
        fillMode: 'outline'
      },
      dates: new Date(event.date),
      popover: {
        label: event.titre,
      },
    }
  })
]

</script>
